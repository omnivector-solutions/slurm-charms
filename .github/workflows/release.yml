name: "release"
  
on:
  push:
  release:
    types: [published]

jobs:
  release:
    name: "Release"
    runs-on: "ubuntu-latest"
    steps:
      - uses: actions/checkout@v1
      - name: "Build & test"
        run: |
          sudo snap install --edge charmcraft
          ls -la
          sudo apt-get install git
          for charm in slurmctld slurmd slurmdbd slurmrestd; do
              cd charm-$charm
              ls -la
              cat requirements.txt
              charmcraft build --verbose
              mv $charm.charm ../
              cd ..
          done
          sudo cat /home/runner/snap/charmcraft/common/charmcraft-log-*
          tar -cvf slurm_charms.tar slurmd.charm slurmctld.charm slurmdbd.charm slurmrestd.charm
          #- name: "Upload binaries to release"
          #uses: svenstaro/upload-release-action@v2
          #with:
          #repo_token: ${{ secrets.GITHUB_TOKEN }}
          #file: slurm_charms.tar
          #asset_name: slurm_charms
          #tag: ${{ github.ref }}
          #overwrite: true
          #body: "Slurm Charms tar file"
